on: [workflow_dispatch]

name: TestQS
env:
  RG_NAME: horus-rg
  SA_NAME: horus23805train
  CNR_NAME: xyz123  

jobs:
  
  test:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2

    - name: Login to Azure
      uses: azure/login@v1
      with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
          
    

    - name: Run a multi-line script
      run: |
        trainingStorageAccountConnectionString=$(az storage account show-connection-string -g $RG_NAME -n $SA_NAME -o tsv)
        az storage container create -n $CNR_NAME --connection-string $trainingStorageAccountConnectionString
        trainingSasToken=$(az storage container generate-sas -n $CNR_NAME --connection-string $trainingStorageAccountConnectionString --expiry 2020-12-31 --permissions acdlrw -o tsv)
        trainingContainerSasUri=$(az storage account show -n $SA_NAME --query primaryEndpoints.blob -o tsv)$CNR_NAME?$trainingSasToken
        azcopy copy Horus/Horus.Trainer/quickstart $trainingContainerSasUri --recursive=true --from-to LocalBlob
